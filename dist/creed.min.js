!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.creed=t.creed||{})}(this,function(t){"use strict";function e(t){return(t.state()&C)>0}function n(t){return(t.state()&H)>0}function r(t){return(t.state()&q)>0}function o(t){return(t.state()&K)>0}function i(t){return(t.state()&W)>0}function c(t){t._runAction($)}function u(t,e){if(null==e)return t;var n=ut(e.stack);return u(n.indexOf(" at ")<0?t:t+"\n"+n,e.next)}function s(t,e){try{!function(t,e){for(var n=0;n<t.length;++n){var r=t[n];i(r)||e(r)}}(e,t)}finally{e.length=0}}function p(){}function a(t){return("object"==typeof t||"function"==typeof t)&&null!==t}function f(t,e,n,r){var o;try{o=t(e)}catch(t){return void r._reject(t)}n(r,o)}function h(t,e,n,r){return n._when(new ft(t,e,r)),r}function l(t,e){t._resolve(e)}function y(t,e){t._fulfill(e)}function d(t,e){t._reject(e)}function v(t,e){a(e)&&"function"==typeof e.then||t._reject(new TypeError("f must return a promise")),t._resolve(e)}function _(t){return Array.isArray(t)?new Array(t.length):[]}function m(t,e,n,r){var o=Array.isArray(n)?function(t,e,n,r){for(var o=0;o<n.length;++o)b(t,e,n[o],o,r);e.complete(o,r)}:function(t,e,n,r){var o=0,i=n[Symbol.iterator]();for(;;){var c=i.next();if(c.done)break;b(t,e,c.value,o++,r)}e.complete(o,r)};try{o(t,e,n,r)}catch(t){r._reject(t)}return r.near()}function b(t,r,o,i,u){if(a(o)){var s=t(o);u._isResolved()?e(s)||c(s):e(s)?r.fulfillAt(s,i,u):n(s)?r.rejectAt(s,i,u):s._runAction(new wt(r,i,u))}else r.valueAt(o,i,u)}function w(t){return E(t)?t.near():a(t)?R(A,t):new Ot(t)}function g(t){return new Et(t)}function j(){return new Tt}function A(t){return new Ot(t)}function k(t){return O(new bt(Rt,_(t)),t)}function x(t){return O(new mt,t)}function O(t,e){if(!function(t){return"object"==typeof t&&null!==t}(e))return g(new TypeError("expected an iterable"));return m(T,t,e,new xt)}function E(t){return t instanceof kt}function T(t){return E(t)?t.near():R(A,t)}function R(t,e){try{var n=e.then;return"function"==typeof n?function(t,e){var n=new xt;try{t.call(e,function(t){return n._resolve(t)},function(t){return n._reject(t)})}catch(t){n._reject(t)}return n.near()}(n,e):t(e)}catch(t){return new Et(t)}}function S(t,e){e._become(t)}function P(t){t._reject(new Dt("promise timeout"))}function N(t,e,n,r){function o(t){var e=Z(r.context);r._resolve(t),Z(e)}function i(t){var e=Z(r.context);r._reject(t),Z(e)}switch(n.length){case 0:t.call(e,o,i);break;case 1:t.call(e,n[0],o,i);break;case 2:t.call(e,n[0],n[1],o,i);break;case 3:t.call(e,n[0],n[1],n[2],o,i);break;default:n.push(o,i),t.apply(e,n)}return r}function D(t,e,n,r){function o(t,e){var n=Z(r.context);t?r._reject(t):r._fulfill(e),Z(n)}switch(n.length){case 0:t.call(e,o);break;case 1:t.call(e,n[0],o);break;case 2:t.call(e,n[0],n[1],o);break;case 3:t.call(e,n[0],n[1],n[2],o);break;default:n.push(o),t.apply(e,n)}return r}function M(t,e,n,r,o){!function(t){if("function"!=typeof t)throw new TypeError("must provide a resolver function")}(e);try{t(e,n,r,o)}catch(t){o._reject(t)}return o}function V(){var t="function"==typeof Promise&&Promise;return"undefined"!=typeof self?self.Promise=$t:"undefined"!=typeof global&&(global.Promise=$t),t}var z=1,C=2,H=4,q=C|H,K=8,W=16,$={fulfilled:function(){},rejected:function(t){t._state|=W}},B="undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process),F="function"==typeof MutationObserver&&MutationObserver||"function"==typeof WebKitMutationObserver&&WebKitMutationObserver,G=function(t){return B&&process.env[t]},U=G("CREED_DEBUG")||"development"===G("NODE_ENV")||"test"===G("NODE_ENV"),I=function(t){return B?function(t){return function(){return process.nextTick(t)}}(t):F?function(t){var e=document.createTextNode("");new F(t).observe(e,{characterData:!0});var n=0;return function(){e.data=n^=1}}(t):function(t){return function(){return setTimeout(t,0)}}(t)},J=function(){var t=this;this.tasks=new Array(65536),this.length=0,this.drain=I(function(){return t._drain()})};J.prototype.add=function(t){0===this.length&&this.drain(),this.tasks[this.length++]=t},J.prototype._drain=function(){for(var t=this.tasks,e=0;e<this.length;++e)t[e].run(),t[e]=void 0;this.length=0};var L,Q=function(){},X=Q,Y=function(t,e){return X(L,t,e)},Z=function(t){var e=L;return L=t,e},tt=function(t,e){X=t,L=e},et=function(){return tt(nt,void 0)},nt=function(t,e,n){return new ot(t,n||e.name,e)},rt=Error.captureStackTrace||Q,ot=function(t,e,n){this.next=t,this.tag=e,rt(this,n)};ot.prototype.toString=function(){return this.tag?" from "+this.tag+":":" from previous context:"};var it=function(t,e){return null!=e?function(t,e){return t instanceof Error&&!("_creed$OriginalStack"in t)&&(t._creed$OriginalStack=t.stack,t.stack=u(ut(t.stack),e)),t}(t,e):t},ct=/\s*at\s.*(creed[\\/](src|dist)[\\/]|internal[\\/]process[\\/]|\((timers|module)\.js).+:\d.*/g,ut=function(t){return"string"==typeof t?t.replace(ct,""):""},st=function(t,e){this.rejections=[],this.emit=t,this.reportError=e};st.prototype.track=function(t){var e=it(t.value,t.context);this.emit("unhandledRejection",t,e)||(0===this.rejections.length&&setTimeout(s,1,this.reportError,this.rejections),this.rejections.push(t))},st.prototype.untrack=function(t){c(t),this.emit("rejectionHandled",t)};var pt="unhandledRejection",at=function(t){this.promise=t,this.context=Y(this.constructor)};at.prototype.fulfilled=function(t){this.promise._become(t)},at.prototype.rejected=function(t){return this.promise._become(t),!1};var ft=function(t){function e(e,n,r){t.call(this,r),this.f=e,this.r=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.fulfilled=function(t){this.runThen(this.f,t)},e.prototype.rejected=function(t){return this.runThen(this.r,t)},e.prototype.runThen=function(t,e){return"function"!=typeof t?(this.promise._become(e),!1):(f(t,e.value,l,this.promise),!0)},e}(at),ht=function(t,e,n){return e._when(new lt(t,n)),n},lt=function(t){function e(e,n){t.call(this,n),this.f=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.fulfilled=function(t){f(this.f,t.value,y,this.promise)},e}(at),yt=function(t,e,n,r){return n._when(new dt(t,e,r)),r},dt=function(t){function e(e,n,r){t.call(this,n,r),this.r=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.rejected=function(t){f(this.r,t.value,d,this.promise)},e}(lt),vt=function(t,e,n){return e._when(new _t(t,n)),n},_t=function(t){function e(e,n){t.call(this,n),this.f=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.fulfilled=function(t){f(this.f,t.value,v,this.promise)},e}(at),mt=function(){};mt.prototype.valueAt=function(t,e,n){n._fulfill(t)},mt.prototype.fulfillAt=function(t,e,n){n._become(t)},mt.prototype.rejectAt=function(t,e,n){n._isResolved()?c(t):n._become(t)},mt.prototype.complete=function(t,e){0===t&&e._become(e.constructor.empty())};var bt=function(t,e){this.pending=0,this.results=e,this.mergeHandler=t};bt.prototype.valueAt=function(t,e,n){this.results[e]=t,this.check(this.pending-1,n)},bt.prototype.fulfillAt=function(t,e,n){this.valueAt(t.value,e,n)},bt.prototype.rejectAt=function(t,e,n){n._isResolved()?c(t):n._become(t)},bt.prototype.complete=function(t,e){this.check(this.pending+t,e)},bt.prototype.check=function(t,e){this.pending=t,0===t&&this.mergeHandler.merge(e,this.results)};var wt=function(t){function e(e,n,r){t.call(this,r),this.i=n,this.handler=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.fulfilled=function(t){this.handler.fulfillAt(t,this.i,this.promise)},e.prototype.rejected=function(t){return this.handler.rejectAt(t,this.i,this.promise)},e}(at),gt=function(t,e){return e={exports:{}},t(e,e.exports),e.exports}(function(t){t.exports={equals:"fantasy-land/equals",concat:"fantasy-land/concat",empty:"fantasy-land/empty",map:"fantasy-land/map",contramap:"fantasy-land/contramap",ap:"fantasy-land/ap",of:"fantasy-land/of",alt:"fantasy-land/alt",zero:"fantasy-land/zero",reduce:"fantasy-land/reduce",traverse:"fantasy-land/traverse",chain:"fantasy-land/chain",chainRec:"fantasy-land/chainRec",extend:"fantasy-land/extend",extract:"fantasy-land/extract",bimap:"fantasy-land/bimap",promap:"fantasy-land/promap"}}),jt=new J,At=new st(B&&"function"==typeof process.emit?function(t,e){return t===pt?process.emit(t,e.value,e):process.emit(t,e)}:"undefined"!=typeof self&&"function"==typeof CustomEvent?function(t,e,n){var r;try{r=new n(pt)instanceof n}catch(t){r=!1}return r?function(t,r){var o=new n(t,{detail:{reason:r.value,promise:r},bubbles:!1,cancelable:!0});return!e.dispatchEvent(o)}:t}(p,self,CustomEvent):p,function(t){throw t.value}),kt=function(){this.context=L};kt.empty=function(){return j()},kt.of=function(t){return A(t)},kt[gt.empty]=function(){return j()},kt[gt.of]=function(t){return A(t)},kt.prototype[gt.map]=function(t){return this.map(t)},kt.prototype[gt.bimap]=function(t,e){return this.bimap(t,e)},kt.prototype[gt.ap]=function(t){return t.ap(this)},kt.prototype[gt.chain]=function(t){return this.chain(t)},kt.prototype[gt.concat]=function(t){return this.concat(t)},kt.prototype[gt.alt]=function(t){return this.or(t)},kt[gt.zero]=function(){return j()},kt.prototype.concat=function(t){return this.or(t)};var xt=function(t){function e(){t.call(this),this.ref=void 0,this.action=void 0,this.length=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.then=function(t,n){var r=this.near();return r===this?h(t,n,this,new e):r.then(t,n)},e.prototype.catch=function(t){var n=this.near();return n===this?h(void 0,t,this,new e):n.catch(t)},e.prototype.map=function(t){var n=this.near();return n===this?ht(t,this,new e):n.map(t)},e.prototype.bimap=function(t,n){var r=this.near();return r===this?yt(t,n,this,new e):r.bimap(t,n)},e.prototype.ap=function(t){var e=this.near(),n=t.near();return e===this?this.chain(function(t){return n.map(t)}):e.ap(n)},e.prototype.chain=function(t){var n=this.near();return n===this?vt(t,this,new e):n.chain(t)},e.prototype.or=function(t){var e=this.near(),n=t.near();return r(e)||o(n)?e:r(n)||o(e)?n:x([e,n])},e.prototype.toString=function(){return"[object "+this.inspect()+"]"},e.prototype.inspect=function(){var t=this.near();return t===this?"Promise { pending }":t.inspect()},e.prototype.near=function(){return this._isResolved()?(this.ref=this.ref.near(),this.ref):this},e.prototype.state=function(){return this._isResolved()?this.ref.near().state():z},e.prototype._isResolved=function(){return void 0!==this.ref},e.prototype._when=function(t){this._runAction(t)},e.prototype._runAction=function(t){void 0===this.action?this.action=t:this[this.length++]=t},e.prototype._resolve=function(t){this._become(w(t))},e.prototype._fulfill=function(t){this._become(new Ot(t))},e.prototype._reject=function(t){this._isResolved()||this.__become(new Et(t))},e.prototype._become=function(t){this._isResolved()||this.__become(t)},e.prototype.__become=function(t){this.ref=t===this?new Et(new TypeError("resolution cycle")):t,void 0!==this.action&&jt.add(this)},e.prototype.run=function(){var t=this.ref.near();t._runAction(this.action),this.action=void 0;for(var e=0;e<this.length;++e)t._runAction(this[e]),this[e]=void 0},e}(kt),Ot=function(t){function e(e){t.call(this),this.value=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.then=function(t){return"function"==typeof t?h(t,void 0,this,new xt):this},e.prototype.catch=function(){return this},e.prototype.map=function(t){return ht(t,this,new xt)},e.prototype.bimap=function(t,e){return this.map(e)},e.prototype.ap=function(t){return t.map(this.value)},e.prototype.chain=function(t){return vt(t,this,new xt)},e.prototype.or=function(){return this},e.prototype.toString=function(){return"[object "+this.inspect()+"]"},e.prototype.inspect=function(){return"Promise { fulfilled: "+this.value+" }"},e.prototype.state=function(){return C},e.prototype.near=function(){return this},e.prototype._when=function(t){jt.add(new St(t,this))},e.prototype._runAction=function(t){var e=Z(t.context);t.fulfilled(this),Z(e)},e}(kt),Et=function(t){function e(e){t.call(this),this.value=e,this._state=H,At.track(this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.then=function(t,e){return"function"==typeof e?this.catch(e):this},e.prototype.catch=function(t){return h(void 0,t,this,new xt)},e.prototype.map=function(){return this},e.prototype.bimap=function(t){return yt(t,void 0,this,new xt)},e.prototype.ap=function(){return this},e.prototype.chain=function(){return this},e.prototype.or=function(){return this},e.prototype.toString=function(){return"[object "+this.inspect()+"]"},e.prototype.inspect=function(){return"Promise { rejected: "+this.value+" }"},e.prototype.state=function(){return this._state},e.prototype.near=function(){return this},e.prototype._when=function(t){jt.add(new St(t,this))},e.prototype._runAction=function(t){var e=Z(t.context);t.rejected(this)&&At.untrack(this),Z(e)},e}(kt),Tt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.then=function(){return this},e.prototype.catch=function(){return this},e.prototype.map=function(){return this},e.prototype.bimap=function(){return this},e.prototype.ap=function(){return this},e.prototype.chain=function(){return this},e.prototype.or=function(t){return t},e.prototype.toString=function(){return"[object "+this.inspect()+"]"},e.prototype.inspect=function(){return"Promise { never }"},e.prototype.state=function(){return z|K},e.prototype.near=function(){return this},e.prototype._when=function(){},e.prototype._runAction=function(){},e}(kt),Rt={merge:function(t,e){t._fulfill(e)}},St=function(t,e){this.action=t,this.promise=e};St.prototype.run=function(){this.promise._runAction(this.action)};var Pt=function(t,e,n){return e._runAction(new Nt(t,n)),n},Nt=function(t){function e(e,n){t.call(this,n),this.time=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.fulfilled=function(t){setTimeout(S,this.time,t,this.promise)},e}(at),Dt=function(t){function e(n){t.call(this),this.message=n,this.name=e.name,"function"==typeof t.captureStackTrace&&t.captureStackTrace(this,e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),Mt=function(t,e,n){var r=setTimeout(P,t,n);return e._runAction(new Vt(r,n)),n},Vt=function(t){function e(e,n){t.call(this,n),this.timer=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.fulfilled=function(t){clearTimeout(this.timer),this.promise._become(t)},e.prototype.rejected=function(e){return clearTimeout(this.timer),t.prototype.rejected.call(this,e)},e}(at),zt=function(){this.pending=0};zt.prototype.valueAt=function(t,e,n){n._fulfill(t)},zt.prototype.fulfillAt=function(t,e,n){n._become(t)},zt.prototype.rejectAt=function(t,e,n){c(t),this.check(this.pending-1,n)},zt.prototype.complete=function(t,e){this.check(this.pending+t,e)},zt.prototype.check=function(t,e){this.pending=t,0===t&&e._reject(new RangeError("No fulfilled promises in input"))};var Ct=function(t,e){this.pending=0,this.results=e,this.resolve=t};Ct.prototype.valueAt=function(t,e,n){this.settleAt(this.resolve(t),e,n)},Ct.prototype.fulfillAt=function(t,e,n){this.settleAt(t,e,n)},Ct.prototype.rejectAt=function(t,e,n){c(t),this.settleAt(t,e,n)},Ct.prototype.settleAt=function(t,e,n){this.results[e]=t,this.check(this.pending-1,n)},Ct.prototype.complete=function(t,e){this.check(this.pending+t,e)},Ct.prototype.check=function(t,e){this.pending=t,0===t&&e._fulfill(this.results)};var Ht=function(t,e,n){return new qt(t,e,n).run(),n},qt=function(t){function e(e,n,r){t.call(this,r),this.resolve=e,this.generator=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.run=function(){this.tryStep(this.generator.next,void 0)},e.prototype.tryStep=function(t,e){var n,r=Z(this.context);try{n=t.call(this.generator,e)}catch(t){return void this.handleReject(t)}finally{Z(r)}this.handleResult(n)},e.prototype.handleResult=function(t){if(t.done)return this.promise._resolve(t.value);this.resolve(t.value)._when(this)},e.prototype.handleReject=function(t){this.promise._reject(t)},e.prototype.fulfilled=function(t){this.tryStep(this.generator.next,t.value)},e.prototype.rejected=function(t){return this.tryStep(this.generator.throw,t.value),!0},e}(at);U&&et();var Kt=function(t,e){this.context=Y(this.constructor,bt.name),this.f=t,this.c=e,this.promise=void 0,this.args=void 0};Kt.prototype.merge=function(t,e){this.promise=t,this.args=e,jt.add(this)},Kt.prototype.run=function(){var t=Z(this.context);try{this.promise._resolve(this.f.apply(this.c,this.args))}catch(t){this.promise._reject(t)}Z(t)};var Wt=[],$t=function(t){function e(e){t.call(this),M(N,e,void 0,Wt,this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(xt);$t.resolve=w,$t.reject=g,$t.all=k,$t.race=x,"function"!=typeof Promise&&V(),t.enableAsyncTraces=et,t.disableAsyncTraces=function(){return tt(Q,void 0)},t.resolve=w,t.reject=g,t.future=function(){var t=new xt;return{resolve:function(e){return t._resolve(e)},promise:t}},t.never=j,t.fulfill=A,t.all=k,t.race=x,t.isFulfilled=e,t.isRejected=n,t.isSettled=r,t.isPending=function(t){return(t.state()&z)>0},t.isNever=o,t.getValue=function(t){var n=t.near();if(!e(n))throw new TypeError("getValue called on "+t);return n.value},t.getReason=function(t){var e=t.near();if(!n(e))throw new TypeError("getReason called on "+t);return c(e),e.value},t.coroutine=function(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return function(t,e,n){var r=t.apply(e,n);return Ht(w,r,new xt)}(t,this,e)}},t.fromNode=function(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return M(D,t,this,e,new xt)}},t.runNode=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];return M(D,t,this,e,new xt)},t.runPromise=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];return M(N,t,this,e,new xt)},t.delay=function(t,e){var r=w(e);return t<=0||n(r)||o(r)?r:Pt(t,r,new xt)},t.timeout=function(t,e){var n=w(e);return r(n)?n:Mt(t,n,new xt)},t.any=function(t){return O(new zt,t)},t.settle=function(t){return O(new Ct(w,_(t)),t)},t.merge=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];return function(t,e,n){return O(new bt(new Kt(t,e),_(n)),n)}(t,this,e)},t.shim=V,t.Promise=$t,Object.defineProperty(t,"__esModule",{value:!0})});